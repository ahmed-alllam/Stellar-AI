(()=>{var z=Object.create;var _=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var V=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var K=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var J=(n,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let m of G(t))!H.call(n,m)&&m!==r&&_(n,m,{get:()=>t[m],enumerable:!(o=Z(t,m))||o.enumerable});return n};var Q=(n,t,r)=>(r=n!=null?z(V(n)):{},J(t||!n||!n.__esModule?_(r,"default",{value:n,enumerable:!0}):r,n));var I=K((L,B)=>{(function(n,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof L<"u")t(B);else{var r={exports:{}};t(r),n.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:L,function(n){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=o=>{let m={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(m).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class l extends WeakMap{constructor(s,a=void 0){super(a),this.createItem=s}get(s){return this.has(s)||this.set(s,this.createItem(s)),super.get(s)}}let h=e=>e&&typeof e=="object"&&typeof e.then=="function",f=(e,s)=>(...a)=>{o.runtime.lastError?e.reject(new Error(o.runtime.lastError.message)):s.singleCallbackArg||a.length<=1&&s.singleCallbackArg!==!1?e.resolve(a[0]):e.resolve(a)},v=e=>e==1?"argument":"arguments",R=(e,s)=>function(g,...x){if(x.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${v(s.minArgs)} for ${e}(), got ${x.length}`);if(x.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${v(s.maxArgs)} for ${e}(), got ${x.length}`);return new Promise((b,y)=>{if(s.fallbackToNoCallback)try{g[e](...x,f({resolve:b,reject:y},s))}catch(i){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,i),g[e](...x),s.fallbackToNoCallback=!1,s.noCallback=!0,b()}else s.noCallback?(g[e](...x),b()):g[e](...x,f({resolve:b,reject:y},s))})},O=(e,s,a)=>new Proxy(s,{apply(g,x,b){return a.call(x,e,...b)}}),k=Function.call.bind(Object.prototype.hasOwnProperty),u=(e,s={},a={})=>{let g=Object.create(null),x={has(y,i){return i in e||i in g},get(y,i,w){if(i in g)return g[i];if(!(i in e))return;let c=e[i];if(typeof c=="function")if(typeof s[i]=="function")c=O(e,e[i],s[i]);else if(k(a,i)){let S=R(i,a[i]);c=O(e,e[i],S)}else c=c.bind(e);else if(typeof c=="object"&&c!==null&&(k(s,i)||k(a,i)))c=u(c,s[i],a[i]);else if(k(a,"*"))c=u(c,s[i],a["*"]);else return Object.defineProperty(g,i,{configurable:!0,enumerable:!0,get(){return e[i]},set(S){e[i]=S}}),c;return g[i]=c,c},set(y,i,w,c){return i in g?g[i]=w:e[i]=w,!0},defineProperty(y,i,w){return Reflect.defineProperty(g,i,w)},deleteProperty(y,i){return Reflect.deleteProperty(g,i)}},b=Object.create(e);return new Proxy(b,x)},A=e=>({addListener(s,a,...g){s.addListener(e.get(a),...g)},hasListener(s,a){return s.hasListener(e.get(a))},removeListener(s,a){s.removeListener(e.get(a))}}),T=new l(e=>typeof e!="function"?e:function(a){let g=u(a,{},{getContent:{minArgs:0,maxArgs:0}});e(g)}),p=new l(e=>typeof e!="function"?e:function(a,g,x){let b=!1,y,i=new Promise(N=>{y=function(M){b=!0,N(M)}}),w;try{w=e(a,g,y)}catch(N){w=Promise.reject(N)}let c=w!==!0&&h(w);if(w!==!0&&!c&&!b)return!1;let S=N=>{N.then(M=>{x(M)},M=>{let F;M&&(M instanceof Error||typeof M.message=="string")?F=M.message:F="An unexpected error occurred",x({__mozWebExtensionPolyfillReject__:!0,message:F})}).catch(M=>{console.error("Failed to send onMessage rejected reply",M)})};return S(c?w:i),!0}),C=({reject:e,resolve:s},a)=>{o.runtime.lastError?o.runtime.lastError.message===t?s():e(new Error(o.runtime.lastError.message)):a&&a.__mozWebExtensionPolyfillReject__?e(new Error(a.message)):s(a)},d=(e,s,a,...g)=>{if(g.length<s.minArgs)throw new Error(`Expected at least ${s.minArgs} ${v(s.minArgs)} for ${e}(), got ${g.length}`);if(g.length>s.maxArgs)throw new Error(`Expected at most ${s.maxArgs} ${v(s.maxArgs)} for ${e}(), got ${g.length}`);return new Promise((x,b)=>{let y=C.bind(null,{resolve:x,reject:b});g.push(y),a.sendMessage(...g)})},E={devtools:{network:{onRequestFinished:A(T)}},runtime:{onMessage:A(p),onMessageExternal:A(p),sendMessage:d.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:d.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},P={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return m.privacy={network:{"*":P},services:{"*":P},websites:{"*":P}},u(o,E,m)};n.exports=r(chrome)}else n.exports=globalThis.browser})});var $=Q(I(),1);async function j(n,t,r){}function q(n){let t,r,o,m,l,h,f;return v(),{feed:R,reset:v};function v(){t=!0,r="",o=0,m=-1,l=void 0,h=void 0,f=""}function R(k){r=r?r+k:k,t&&X(r)&&(r=r.slice(W.length)),t=!1;let u=r.length,A=0,T=!1;for(;A<u;){T&&(r[A]===`
`&&++A,T=!1);let p=-1,C=m,d;for(let E=o;p<0&&E<u;++E)d=r[E],d===":"&&C<0?C=E-A:d==="\r"?(T=!0,p=E-A):d===`
`&&(p=E-A);if(p<0){o=u-A,m=C;break}else o=0,m=-1;O(r,A,C,p),A+=p+1}A===u?r="":A>0&&(r=r.slice(A))}function O(k,u,A,T){if(T===0){f.length>0&&(n({type:"event",id:l,event:h||void 0,data:f.slice(0,-1)}),f="",l=void 0),h=void 0;return}let p=A<0,C=k.slice(u,u+(p?T:A)),d=0;p?d=T:k[u+A+1]===" "?d=A+2:d=A+1;let E=u+d,P=T-d,e=k.slice(E,E+P).toString();if(C==="data")f+=e?"".concat(e,`
`):`
`;else if(C==="event")h=e;else if(C==="id"&&!e.includes("\0"))l=e;else if(C==="retry"){let s=parseInt(e,10);Number.isNaN(s)||n({type:"reconnect-interval",value:s})}}}var W=[239,187,191];function X(n){return W.every((t,r)=>n.charCodeAt(r)===t)}async function*U(n){let t=n.getReader();try{for(;;){let{done:r,value:o}=await t.read();if(r)return;yield o}}finally{t.releaseLock()}}async function D(n,t){let{onMessage:r,...o}=t,m=await fetch(n,o);if(console.log("in fetch-sse "+m.ok),m.ok){let l=q(f=>{if(f.type==="event"){r(f.data);return}}),h="";for await(let f of U(m.body)){let v=new TextDecoder().decode(f);h+=v,console.log("in fetch-sse "+v),l.feed(v)}r(h)}else{let l=(await m.json().catch(()=>({}))).detail;r("[ERROR]")}}async function Y(n,t){let r,o=()=>{r&&j(r,{is_visible:!1})},m=new AbortController;n.onDisconnect.addListener(()=>{m.abort(),o()}),await D("http://localhost:3000/search?q="+t,{method:"GET",onMessage(l){if(console.debug("sse message",l),l==="[DONE]"){n.postMessage({event:"DONE"}),o();return}let h=l;console.log(l),h&&n.postMessage({data:h})}})}async function ee(n,t){let r,o=()=>{r&&j(r,{is_visible:!1})},m=new AbortController;n.onDisconnect.addListener(()=>{m.abort(),o()}),console.log("allam ",t),await D("http://localhost:3000/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t}),onMessage(l){if(console.debug("sse message",l),l==="[DONE]"){n.postMessage({event:"DONE"}),o();return}l==="[DONE]"?(n.postMessage({event:"DONE"}),o()):l==="[ERROR]"?(n.postMessage({error:"ERROR"}),o()):l&&n.postMessage({data:l})}})}$.default.runtime.onConnect.addListener(n=>{n.onMessage.addListener(async t=>{if(t.question!==void 0){console.debug("received msg",t);try{await Y(n,t.question)}catch(r){console.error(r),n.postMessage({error:r.message})}}else if(t.article!==void 0)try{await ee(n,t.article)}catch(r){console.error(r),n.postMessage({error:r.message})}})});$.default.runtime.onMessage.addListener(async n=>{n.type});})();
